\documentclass{article}

% - style template
\usepackage{base}

\usetikzlibrary{external}
\tikzexternalize[mode=list and make]

% - title, author, etc.
\title{PHYS4000 - Workshop 3}
\author{Tom Ross - 1834 2884}
\date{\today}

% - headers
\pagestyle{fancy}
\fancyhf{}
\rhead{\theauthor}
\chead{}
\lhead{\thetitle}
\rfoot{\thepage}
\cfoot{}
\lfoot{}

% - output files
\newcommand{\wffile}[2]{../output/qho/wf.n_x-#1.#2.txt}
\newcommand{\enfile}[1]{../output/qho/en.#1.txt}
\newcommand{\itfile}[1]{../output/qho/it.#1.txt}

\pgfplotstableread{\enfile{sb}}{\ensb}
\pgfplotstableread{\enfile{nc}}{\ennc}

\pgfplotstableread{\itfile{sb}}{\itsb}
\pgfplotstableread{\itfile{nc}}{\itnc}

% \def\kpowset{1024,2048,4096,8192,16384,32768,65536,131072}
% \def\kset{10,11,12,13,14,15,16,17}
% \def\kmin{10}
% \def\kmax{17}

\def\kpowset{1024,2048,4096}
\def\kset{10,11,12}
\def\kmin{10}
\def\kmax{12}

\def\nset{0,1,2,3}
\def\nmin{0}
\def\nmax{3}

% - document
\begin{document}

\tableofcontents

\listoffigures

\listoftables

\clearpage

\section{Quantum Harmonic Oscillator}
\label{sec:qho}

\subsection*{Discussion of Theory}
\label{sec:qho-theory}

\subsection*{Wavefunctions}
\label{sec:qho-wavefunctions}

\begin{figure}[h]
  \centering
  \begin{tikzpicture}
    \begin{axis}[
      use units
      , scale = 1.0
      , title = {
        TITLE
      }
      , grid = major
      , xmin = -5.0
      , xmax =  5.0
      , ymin = -0.5
      , ymax =  4.5
      , xlabel = {$x$}
      , ylabel = {Energy}
      , x unit = {a_{0}}
      , y unit = {Ha}
      , restrict x to domain = -5.5:5.5
      , restrict y to domain = -1.0:5.0
      , legend entries
      , legend style = {
        cells = {anchor=east}
        , legend pos = south east
        , font = \tiny
      }
      ]

      \pgfmathdeclarefunction{v}{1}{\pgfmathparse{0.5*(#1)*(#1)}}

      \addplot [
      color = blue
      , domain = -5.0:5.0
      , samples = 100
      ]({x} , {v(x)});

      \pgfplotstableread{\wffile{1024}{an}}{\wfan}

      \foreach\n in \nset{
        \pgfmathtruncatemacro{\idx}{\n - \nmin + 1}
        \pgfmathtruncatemacro{\c}{100.0*real(\n - \nmin)/real(\nmax - \nmin)}
        \edef\temp{
          \noexpand\addplot [
          color = red!\c!black
          ] table [
          x index = 0
          , y expr = (0.5*\noexpand\thisrowno{\idx}) + \n + 0.5
          ]{\noexpand\wfan};
          \noexpand\addlegendentry{$\idx$}
        }\temp
      }

      % \foreach\k in \kset{
      %   \pgfmathtruncatemacro{\kpow}{pow(2, \k)}
      %   \pgfplotstableread{\wffile{\kpow}{sb}}{\wfsb}

      %   \pgfmathtruncatemacro{\jdx}{\k - \kmin + 1}
      %   \pgfmathtruncatemacro{\d}{100.0*real(\k - \kmin)/real(\kmax - \kmin)}
      %   \foreach\n in \nset{
      %     \pgfmathtruncatemacro{\idx}{\n - \nmin + 1}
      %     \pgfmathtruncatemacro{\c}{100.0*real(\n - \nmin)/real(\nmax - \nmin)}

      %     \edef\temp{
      %       \noexpand\addplot [
      %       color = blue!\d!black
      %       ] table [
      %       x index = 0
      %       , y expr = (0.5*\noexpand\thisrowno{\idx}) + \n + 0.5
      %       ]{\noexpand\wfsb};
      %       % \noexpand\addlegendentry{$\idx$}
      %     }\temp
      %   }

      %   \pgfplotstableclear{\wfsb}
      % }

      % \addlegendentryexpanded{$\lr{\delta x}_{\idx} = 10*2^{-\k}$}

      % \pgfplotstableread[
      % col sep = space
      % , header = false
      % ]{\wffile{1024}{an}}{\data}

      % \addplot [
      % color = black
      % , mark = diamond*
      % ] table [x index = {0}, y index = {1}] \data;
      % \addlegendentry{\lstinline{cpu_elapsed_time}}

    \end{axis}
  \end{tikzpicture}
  \caption[Bleh]{
    Blah blah.
  }
  \label{fig:qho-wavefunctions}
\end{figure}

\subsection*{Energies}
\label{sec:qho-energies}

\subsection*{Iterations}
\label{sec:qho-iterations}

\end{document}
